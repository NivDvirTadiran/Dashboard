<!-- Widget Header -->
<div class="widget-header">
    <h3>{{ widget?.title }}</h3>
    <div class="widget-controls">
        <button (click)="refreshWidget(widget?.id)" class="refresh-btn" title="Refresh Widget" [disabled]="!widget?.id">
          <fa-icon [icon]="faSyncAlt"></fa-icon>
        </button>
        <button (click)="toggleSettingsModal()" class="settings-btn" title="Widget Settings">
            <fa-icon [icon]="faEllipsisV"></fa-icon>
        </button>
    </div>
</div>

<div class="widget-content">
  <!-- Loading indicator -->
  <div *ngIf="widget?.state?.loading" class="loading-spinner">
    <div class="spinner-border" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>

  <!-- Error message -->
  <div *ngIf="widget?.state?.error" class="error-message">
    <i class="fas fa-exclamation-triangle"></i>
    {{ widget?.state?.error }}
  </div>

  <!-- Trans cluded content for specific widget data -->
  <ng-content></ng-content>

</div>

<!-- Widget Footer -->
<div class="widget-footer" *ngIf="widget?.state?.lastUpdated">
    <i class="fas fa-clock"></i> Last updated: {{ widget?.state?.lastUpdated | date:'medium' }}
</div>

<!-- Settings Modal -->
<div class="modal-overlay" *ngIf="showSettingsModal" (click)="closeSettingsModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Edit Widget Settings</h3>
      <button class="close-modal-btn" (click)="closeSettingsModal()" title="Close">
        <fa-icon [icon]="faTimes"></fa-icon>
      </button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label for="widgetName">Widget Name</label>
        <input type="text" id="widgetName" [(ngModel)]="editableWidgetName" name="widgetName">
      </div>
      <div class="form-group">
        <label for="widgetDescription">Widget Description</label>
        <input type="text" id="widgetDescription" [(ngModel)]="editableWidgetDescription" name="widgetDescription">
      </div>
      <!-- Agent Selection for brief-agents-widget -->
      <ng-container *ngIf="widget.type === 'brief-agents-widget'">
        <div class="form-group">
          <label>Filter Agents:</label>
          <div *ngIf="isLoadingAgents" class="loading-small">Loading agents...</div>
          <div *ngIf="!isLoadingAgents && agentsForSelection.length === 0" class="no-agents-message">
            No agents available for selection.
          </div>
          <div class="checkbox-group scrollable-checkbox-group" *ngIf="!isLoadingAgents && agentsForSelection.length > 0">
            <label *ngFor="let agent of agentsForSelection">
              <input type="checkbox" [(ngModel)]="agent.selected" [name]="'agent_' + agent.id"> {{ agent.name }} ({{ agent.id }})
            </label>
          </div>
        </div>
      </ng-container>
      <!-- Placeholder for other widget type options -->
      <div *ngIf="widget.type !== 'brief-agents-widget'" class="form-group">
        <label>Options:</label>
        <div class="checkbox-group">
          <label><input type="checkbox" name="option1_generic"> Generic Option 1</label>
          <label><input type="checkbox" name="option2_generic"> Generic Option 2</label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeSettingsModal()">Cancel</button>
      <button class="btn btn-primary" (click)="saveSettings()">Save</button>
    </div>
  </div>
</div>
